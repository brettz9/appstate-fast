{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { ref, Ref, onUnmounted } from 'vue'\n\nexport class State<S> {\n  private val: S\n  private readonly subscribers: { ref: Ref<S> }[]\n\n  constructor(value: S) {\n    this.val = value\n    this.subscribers = []\n  }\n\n  get value(): S {\n    return this.val\n  }\n\n  set(value: S): void {\n    this.val = value\n    this.subscribers.forEach(s => {\n      s.ref.value = this.val\n      console.log(s.ref.value)\n    })\n  }\n\n  update(op: (value: S) => void): void {\n    op(this.val)\n    this.subscribers.forEach(s => {\n      s.ref.value = this.val\n      console.log(s.ref.value)\n    })\n  }\n\n  subscribe(subscriber: { ref: Ref<S> }): () => void {\n    this.subscribers.push(subscriber)\n    return () => {\n      const index = this.subscribers.indexOf(subscriber)\n      if (index !== -1) {\n        this.subscribers.splice(index, 1)\n      }\n    }\n  }\n}\n\nexport function createState<S>(source: S): State<S> {\n  const state = new State(source)\n  return state\n}\n\nexport function useState<S>(state: S | State<S>): Ref<S> {\n  if (state instanceof State) {\n    const subscriber = ref(state.value) as Ref<S>\n    const unsubscribe = state.subscribe({ ref: subscriber })\n    onUnmounted(() => unsubscribe())\n    return subscriber\n  } else {\n    const value = ref(state) as Ref<S>\n    return value\n  }\n}\n"],"names":["ref","onUnmounted"],"mappings":";;;;;;MAEa,KAAK;IAIhB,YAAY,KAAQ;QAClB,IAAI,CAAC,GAAG,GAAG,KAAK,CAAA;QAChB,IAAI,CAAC,WAAW,GAAG,EAAE,CAAA;KACtB;IAED,IAAI,KAAK;QACP,OAAO,IAAI,CAAC,GAAG,CAAA;KAChB;IAED,GAAG,CAAC,KAAQ;QACV,IAAI,CAAC,GAAG,GAAG,KAAK,CAAA;QAChB,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YACxB,CAAC,CAAC,GAAG,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAA;YACtB,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;SACzB,CAAC,CAAA;KACH;IAED,MAAM,CAAC,EAAsB;QAC3B,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QACZ,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YACxB,CAAC,CAAC,GAAG,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAA;YACtB,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;SACzB,CAAC,CAAA;KACH;IAED,SAAS,CAAC,UAA2B;QACnC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;QACjC,OAAO;YACL,MAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,UAAU,CAAC,CAAA;YAClD,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;gBAChB,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAA;aAClC;SACF,CAAA;KACF;CACF;SAEe,WAAW,CAAI,MAAS;IACtC,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAA;IAC/B,OAAO,KAAK,CAAA;AACd,CAAC;SAEe,QAAQ,CAAI,KAAmB;IAC7C,IAAI,KAAK,YAAY,KAAK,EAAE;QAC1B,MAAM,UAAU,GAAGA,OAAG,CAAC,KAAK,CAAC,KAAK,CAAW,CAAA;QAC7C,MAAM,WAAW,GAAG,KAAK,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,UAAU,EAAE,CAAC,CAAA;QACxDC,eAAW,CAAC,MAAM,WAAW,EAAE,CAAC,CAAA;QAChC,OAAO,UAAU,CAAA;KAClB;SAAM;QACL,MAAM,KAAK,GAAGD,OAAG,CAAC,KAAK,CAAW,CAAA;QAClC,OAAO,KAAK,CAAA;KACb;AACH;;;;;;"}