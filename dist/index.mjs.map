{"version":3,"file":"index.mjs","sources":["../src/index.ts"],"sourcesContent":["import { ref, Ref, onUnmounted, triggerRef, readonly, onMounted } from 'vue'\n\nexport class State<S> {\n  private val: S\n  private readonly subscribers: ((value: S) => void)[]\n\n  constructor(value: S) {\n    this.val = value\n    this.subscribers = []\n  }\n\n  get value(): S {\n    return this.val\n  }\n\n  set(value: S): void {\n    this.val = value\n    this.subscribers.forEach(s => s(this.val))\n  }\n\n  update(op: (value: S) => S): void {\n    this.val = op(this.val)\n    this.subscribers.forEach(s => s(this.val))\n  }\n\n  subscribe(sub: (value: S) => void): () => void {\n    this.subscribers.push(sub)\n    return () => {\n      const index = this.subscribers.indexOf(sub)\n      if (index !== -1) {\n        this.subscribers.splice(index, 1)\n      }\n    }\n  }\n}\n\nexport function createState<S>(source: S): State<S> {\n  const state = new State(source)\n  return state\n}\n\ninterface StateMethods<S> {\n  state: Ref<S>\n  set: (value: S) => void\n}\n\nexport function useState<S>(state: S | State<S>): StateMethods<S> {\n  // if (state instanceof State) {\n  //   const value = ref(state.value) as Ref<S>\n\n  //   const set = (newValue: S) => {\n  //     value.value = newValue\n  //     triggerRef(value)\n  //   }\n\n  //   const unsubscribe = state.subscribe(set)\n  //   onUnmounted(() => unsubscribe())\n\n  //   return { state: readonly(value) as Ref<S>, set }\n  // } else {\n  //   const value = ref(state) as Ref<S>\n\n  //   const set = (newValue: S) => {\n  //     value.value = newValue\n  //     triggerRef(value)\n  //   }\n\n  //   return { state: readonly(value) as Ref<S>, set }\n  // }\n\n  onMounted(() => console.log('state mounted!'))\n  onUnmounted(() => console.log('state unmounted!'))\n\n  return {\n    state: readonly({}) as Ref<S>,\n    set: () => {\n      /**/\n    },\n  }\n}\n"],"names":[],"mappings":";;MAEa,KAAK;IAIhB,YAAY,KAAQ;QAClB,IAAI,CAAC,GAAG,GAAG,KAAK,CAAA;QAChB,IAAI,CAAC,WAAW,GAAG,EAAE,CAAA;KACtB;IAED,IAAI,KAAK;QACP,OAAO,IAAI,CAAC,GAAG,CAAA;KAChB;IAED,GAAG,CAAC,KAAQ;QACV,IAAI,CAAC,GAAG,GAAG,KAAK,CAAA;QAChB,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAA;KAC3C;IAED,MAAM,CAAC,EAAmB;QACxB,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QACvB,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAA;KAC3C;IAED,SAAS,CAAC,GAAuB;QAC/B,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QAC1B,OAAO;YACL,MAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,CAAA;YAC3C,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;gBAChB,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAA;aAClC;SACF,CAAA;KACF;CACF;SAEe,WAAW,CAAI,MAAS;IACtC,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAA;IAC/B,OAAO,KAAK,CAAA;AACd,CAAC;SAOe,QAAQ,CAAI,KAAmB;;;;;;;;;;;;;;;;;;IAwB7C,SAAS,CAAC,MAAM,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC,CAAA;IAC9C,WAAW,CAAC,MAAM,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC,CAAA;IAElD,OAAO;QACL,KAAK,EAAE,QAAQ,CAAC,EAAE,CAAW;QAC7B,GAAG,EAAE;;SAEJ;KACF,CAAA;AACH;;;;"}