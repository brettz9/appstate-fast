{"version":3,"file":"index.mjs","sources":["../src/index.ts"],"sourcesContent":["import { ref, Ref, onUnmounted, customRef, triggerRef } from 'vue'\n\nexport class State<S> {\n  value: S\n  private readonly subscribers: (() => void)[]\n\n  constructor(value: S) {\n    this.value = value\n    this.subscribers = []\n  }\n\n  _sync(): void {\n    this.subscribers.forEach(s => s())\n  }\n\n  subscribe(trigger: () => void): () => void {\n    this.subscribers.push(trigger)\n    return () => {\n      const index = this.subscribers.indexOf(trigger)\n      if (index !== -1) {\n        this.subscribers.splice(index, 1)\n      }\n    }\n  }\n}\n\nexport function createState<S>(source: S): State<S> {\n  const state = new State(source)\n\n  const proxy = new Proxy(state, {\n    set(obj, prop, value) {\n      obj[prop] = value as unknown\n\n      if (prop === 'value') {\n        obj._sync()\n      }\n\n      return true\n    },\n  })\n\n  return proxy\n}\n\nexport function useState<S>(state: S | State<S>): Ref<S> {\n  if (!(state instanceof State)) {\n    // Local state\n    return ref(state) as Ref<S>\n  }\n\n  // Global state\n  const value = customRef(track => ({\n    get() {\n      track()\n      return state.value\n    },\n\n    set(newValue: S) {\n      state.value = newValue\n      // triggering is done by global state\n    },\n  }))\n\n  const trigger = () => triggerRef(value)\n  const unsubscribe = state.subscribe(trigger)\n  onUnmounted(() => unsubscribe())\n\n  return value\n}\n"],"names":[],"mappings":";;MAEa,KAAK;IAIhB,YAAY,KAAQ;QAClB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAA;QAClB,IAAI,CAAC,WAAW,GAAG,EAAE,CAAA;KACtB;IAED,KAAK;QACH,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;KACnC;IAED,SAAS,CAAC,OAAmB;QAC3B,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QAC9B,OAAO;YACL,MAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;YAC/C,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;gBAChB,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAA;aAClC;SACF,CAAA;KACF;CACF;SAEe,WAAW,CAAI,MAAS;IACtC,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAA;IAE/B,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,KAAK,EAAE;QAC7B,GAAG,CAAC,GAAG,EAAE,IAAI,EAAE,KAAK;YAClB,GAAG,CAAC,IAAI,CAAC,GAAG,KAAgB,CAAA;YAE5B,IAAI,IAAI,KAAK,OAAO,EAAE;gBACpB,GAAG,CAAC,KAAK,EAAE,CAAA;aACZ;YAED,OAAO,IAAI,CAAA;SACZ;KACF,CAAC,CAAA;IAEF,OAAO,KAAK,CAAA;AACd,CAAC;SAEe,QAAQ,CAAI,KAAmB;IAC7C,IAAI,EAAE,KAAK,YAAY,KAAK,CAAC,EAAE;;QAE7B,OAAO,GAAG,CAAC,KAAK,CAAW,CAAA;KAC5B;;IAGD,MAAM,KAAK,GAAG,SAAS,CAAC,KAAK,KAAK;QAChC,GAAG;YACD,KAAK,EAAE,CAAA;YACP,OAAO,KAAK,CAAC,KAAK,CAAA;SACnB;QAED,GAAG,CAAC,QAAW;YACb,KAAK,CAAC,KAAK,GAAG,QAAQ,CAAA;;SAEvB;KACF,CAAC,CAAC,CAAA;IAEH,MAAM,OAAO,GAAG,MAAM,UAAU,CAAC,KAAK,CAAC,CAAA;IACvC,MAAM,WAAW,GAAG,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,CAAA;IAC5C,WAAW,CAAC,MAAM,WAAW,EAAE,CAAC,CAAA;IAEhC,OAAO,KAAK,CAAA;AACd;;;;"}